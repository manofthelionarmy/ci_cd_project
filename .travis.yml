language: node_js
node_js: 
    - "8.11.1"
dist: trusty
sudo: required

services:
  - mongodb

branches: 
  only:
    - master

matrix:
  
  include: 
    #Concurrent Tests: Express Unit Tests
    - name: "Node Test"
      #Splitting the Node Test into two stages
      cache:
            directories:
              - backend/node_modules
      env:
        - NODE_ENV=unit_test
        - CI_CD_PROJ=${HOME}/build/manofthelionarmy/ci_cd_project
      before_install: 
        - cd ${CI_CD_PROJ}/backend
      install:
          - npm install
      before_script: 
        - cd ${CI_CD_PROJ}/backend
      script:
          - npm run unit_test
          
    #Concurrent Test: Angular Unit Tests
    - name: 'Angular Test'

      addons:
        apt:
          sources:
            - google-chrome
          packages:
            - google-chrome-stable

      cache:
            directories:
              - frontend/node_modules
      env:
        - CI_CD_PROJ=${HOME}/build/manofthelionarmy/ci_cd_project
      before_install: 
        - npm install -g @angular/cli
        - cd ${CI_CD_PROJ}/frontend
      
      install:
        - npm install
      
      before_script:
        - cd ${CI_CD_PROJ}/frontend
          
      script: npm run test -- --no-watch --no-progress --browsers=ChromeHeadlessCI
          